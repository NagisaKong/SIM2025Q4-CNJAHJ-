<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <!-- 元信息：确保页面自适应不同设备 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>登录 ｜ CSR 志愿服务匹配平台</title>
    <!-- 引入统一的简约样式 -->
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="login">
    <!-- 登录容器：水平垂直居中展示主要内容 -->
    <main class="login__container">
      <header class="login__header">
        <h1>欢迎访问 CSR 志愿服务匹配平台</h1>
        <p>请先登录或创建账户后继续。</p>
      </header>

      <% const flashMessage = typeof flash !== 'undefined' ? flash : null; %>
      <% if (flashMessage) { %>
        <div class="flash flash--<%= flashMessage.type %>">
          <p><%= flashMessage.message %></p>
        </div>
      <% } %>

      <!-- 登录表单：支持所有角色使用同一入口 -->
      <section class="login__panel" aria-labelledby="login-title">
        <h2 id="login-title">账户登录</h2>
        <form method="post" action="/login" class="stack-form">
          <!-- 登录身份选择：允许用户明确以何种角色进入平台 -->
          <label for="login-role">登录身份</label>
          <select id="login-role" name="role" required>
            <% roles.forEach((roleOption) => { %>
              <option
                value="<%= roleOption.name %>"
                <%= selectedRole === roleOption.name ? 'selected' : '' %>
              >
                <%= roleOption.name %>
              </option>
            <% }) %>
          </select>

          <label for="login-username">用户名</label>
          <input
            id="login-username"
            name="username"
            type="text"
            placeholder="请输入用户名"
            required
            value="<%= loginPrefill && loginPrefill.username ? loginPrefill.username : '' %>"
          />

          <label for="login-password">密码</label>
          <input
            id="login-password"
            name="password"
            type="password"
            placeholder="请输入密码"
            required
          />

          <button type="submit">登录平台</button>
        </form>
      </section>

      <!-- 创建账户选项：满足新用户注册需求 -->
      <section class="login__panel" aria-labelledby="register-title">
        <h2 id="register-title">创建新账户</h2>
        <p class="login__hint">如您尚未拥有平台账号，可在此完成注册（默认启用状态）。</p>
        <form method="post" action="/register" class="stack-form">
          <label for="register-username">用户名</label>
          <input
            id="register-username"
            name="username"
            type="text"
            placeholder="例如：pin.zhang"
            required
          />

          <label for="register-display">姓名</label>
          <input
            id="register-display"
            name="displayName"
            type="text"
            placeholder="请输入姓名"
            required
          />

          <label for="register-password">密码</label>
          <input
            id="register-password"
            name="password"
            type="password"
            placeholder="设置登录密码"
            required
          />

          <label for="register-role">选择角色</label>
          <select id="register-role" name="role" required>
            <% roles.forEach((role) => { %>
              <option value="<%= role.name %>"><%= role.name %></option>
            <% }) %>
          </select>

          <button type="submit">创建账户</button>
        </form>
      </section>

      <!-- 角色简介：帮助用户理解不同角色的职责 -->
      <section class="login__panel" aria-labelledby="roles-title">
        <h2 id="roles-title">角色简介</h2>
        <ul class="role-list">
          <% roles.forEach((role) => { %>
            <li>
              <strong><%= role.name %></strong>
              <ul>
                <% role.highlights.forEach((item) => { %>
                  <li><%= item %></li>
                <% }) %>
              </ul>
            </li>
          <% }) %>
        </ul>
      </section>

      <footer class="login__footer">
        <p>登录后方可访问平台主页。若需要帮助，请联系平台管理员。</p>
      </footer>
    </main>
  </body>
</html>
