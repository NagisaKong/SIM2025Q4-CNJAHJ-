<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta information: keep the layout responsive across devices -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | CSR Volunteer Matching Platform</title>
    <!-- Shared minimal stylesheet -->
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="login">
    <!-- Login wrapper: center the main content horizontally and vertically -->
    <main class="login__container">
      <header class="login__header">
        <h1>Welcome to the CSR Volunteer Matching Platform</h1>
        <p>Please choose your role and enter your account credentials to proceed.</p>
      </header>

      <% const flashMessage = typeof flash !== 'undefined' ? flash : null; %>
      <% const selectedRoleValue = (() => {
          if (typeof selectedRole !== 'undefined' && selectedRole) {
            return selectedRole;
          }
          if (loginPrefill && loginPrefill.role) {
            return loginPrefill.role;
          }
          if (Array.isArray(roles) && roles.length) {
            return roles[0].name;
          }
          return '';
        })();
      %>
      <% if (flashMessage) { %>
        <div class="flash flash--<%= flashMessage.type %>">
          <p><%= flashMessage.message %></p>
        </div>
      <% } %>

      <!-- Login form: the single entry point for every role -->
      <section class="login__panel" aria-labelledby="login-title">
        <h2 id="login-title">Account Login</h2>
        <form method="post" action="/login" class="stack-form">
          <!-- Role selector: users must specify how they want to sign in -->
          <label for="login-role">Sign-in Role</label>
          <select id="login-role" name="role" required>
            <% roles.forEach((roleOption) => { %>
              <option
                value="<%= roleOption.name %>"
                <%= selectedRoleValue === roleOption.name ? 'selected' : '' %>
              >
                <%= roleOption.name %>
              </option>
            <% }) %>
          </select>

          <label for="login-username">Username</label>
          <input
            id="login-username"
            name="username"
            type="text"
            placeholder="Enter your username"
            required
            value="<%= loginPrefill && loginPrefill.username ? loginPrefill.username : '' %>"
          />

          <label for="login-password">Password</label>
          <input
            id="login-password"
            name="password"
            type="password"
            placeholder="Enter your password"
            required
          />

          <button type="submit">Sign In</button>
        </form>
      </section>

      <footer class="login__footer">
        <p>Only authenticated users can access the platform dashboard. Please contact the user administrator if you need a new account.</p>
      </footer>
    </main>
  </body>
</html>
