<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <!-- 元信息：确保页面自适应不同设备 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>登录 ｜ CSR 志愿服务匹配平台</title>
    <!-- 引入统一的简约样式 -->
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="login">
    <!-- 登录容器：水平垂直居中展示主要内容 -->
    <main class="login__container">
      <header class="login__header">
        <h1>欢迎访问 CSR 志愿服务匹配平台</h1>
        <p>请先登录或创建账户后继续。</p>
      </header>

      <% const flashMessage = typeof flash !== 'undefined' ? flash : null; %>
      <% const selectedRoleValue = (() => {
          if (typeof selectedRole !== 'undefined' && selectedRole) {
            return selectedRole;
          }
          if (loginPrefill && loginPrefill.role) {
            return loginPrefill.role;
          }
          if (Array.isArray(roles) && roles.length) {
            return roles[0].name;
          }
          return '';
        })();
      %>
      <% if (flashMessage) { %>
        <div class="flash flash--<%= flashMessage.type %>">
          <p><%= flashMessage.message %></p>
        </div>
      <% } %>

      <!-- 登录表单：支持所有角色使用同一入口 -->
      <section class="login__panel" aria-labelledby="login-title">
        <h2 id="login-title">账户登录</h2>
        <form method="post" action="/login" class="stack-form">
          <!-- 登录身份选择：允许用户明确以何种角色进入平台 -->
          <label for="login-role">登录身份</label>
          <select id="login-role" name="role" required>
            <% roles.forEach((roleOption) => { %>
              <option
                value="<%= roleOption.name %>"
                <%= selectedRoleValue === roleOption.name ? 'selected' : '' %>
              >
                <%= roleOption.name %>
              </option>
            <% }) %>
          </select>

          <label for="login-username">用户名</label>
          <input
            id="login-username"
            name="username"
            type="text"
            placeholder="请输入用户名"
            required
            value="<%= loginPrefill && loginPrefill.username ? loginPrefill.username : '' %>"
          />

          <label for="login-password">密码</label>
          <input
            id="login-password"
            name="password"
            type="password"
            placeholder="请输入密码"
            required
          />

          <button type="submit">登录平台</button>
        </form>
      </section>

      <!-- 创建账户按钮：跳转至独立的注册页面，保持登录界面简洁 -->
      <section class="login__panel" aria-labelledby="register-title">
        <h2 id="register-title">还没有账户？</h2>
        <p class="login__hint">点击下方按钮，按指引完成账户注册后再返回登录。</p>
        <a class="button button--ghost" href="/register">前往创建账户</a>
      </section>

      <footer class="login__footer">
        <p>登录后方可访问平台主页。若需要帮助，请联系平台管理员。</p>
      </footer>
    </main>
  </body>
</html>
