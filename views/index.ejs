<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta information: keep the document encoded correctly and responsive -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSR Volunteer Matching Platform Dashboard</title>
    <!-- Minimal shared stylesheet -->
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <!-- Top navigation: show the current user and the logout action -->
    <header class="top-bar">
      <div class="top-bar__info">
        <h1>CSR Volunteer Matching Platform</h1>
        <p>Signed in as <strong><%= currentUser.displayName %> (<%= currentUser.role %>)</strong></p>
      </div>
      <form class="top-bar__logout" method="post" action="/logout">
        <button type="submit">Sign Out</button>
      </form>
    </header>

    <!-- Flash message area: display success or error hints -->
    <% const flashMessage = typeof flash !== 'undefined' ? flash : null; %>
    <% if (flashMessage) { %>
      <div class="flash flash--<%= flashMessage.type %>">
        <p><%= flashMessage.message %></p>
      </div>
    <% } %>

    <!-- Main content container: group modules by responsibility -->
    <main class="content">
      <!-- Overview: quick summary of the platform capabilities -->
      <section class="section" aria-labelledby="overview-title">
        <h2 id="overview-title">Platform Overview</h2>
        <p>
          The dashboard brings together the core operations for CSR representatives, persons in need (PIN), platform managers, and user administrators, covering account maintenance, volunteer matching, and reporting insights.
        </p>
      </section>

      <!-- User administrator workspace: only visible to the admin role -->
      <% if (currentUser.role === 'User Administrator') { %>
        <section class="section" aria-labelledby="account-admin-title">
          <h2 id="account-admin-title">User Administrator Workspace</h2>
          <div class="grid">
            <!-- Create account form -->
            <form class="card" method="post" action="/admin/accounts/create">
              <h3>Create User Account</h3>
              <label>Username
                <input type="text" name="username" placeholder="e.g. admin.reed" required />
              </label>
              <label>Display name
                <input type="text" name="displayName" placeholder="Enter full name" required />
              </label>
              <label>Initial password
                <input type="password" name="password" placeholder="Set a login password" required />
              </label>
              <label>Role
                <select name="role" required>
                  <% roles.forEach((role) => { %>
                    <option value="<%= role.name %>"><%= role.name %></option>
                  <% }) %>
                </select>
              </label>
              <label>Status
                <select name="status" required>
                  <option value="active">Active</option>
                  <option value="suspended">Suspended</option>
                </select>
              </label>
              <button type="submit">Create Account</button>
            </form>

            <!-- Create profile form -->
            <form class="card" method="post" action="/admin/profiles/create">
              <h3>Create User Profile</h3>
              <label>Profile name
                <input type="text" name="name" placeholder="e.g. CSR Representative" required />
              </label>
              <label>Description
                <textarea name="description" rows="3" placeholder="Summarise the responsibilities" required></textarea>
              </label>
              <label>Permissions (comma separated)
                <input type="text" name="permissions" placeholder="Create or update accounts, assign role permissions" />
              </label>
              <button type="submit">Create Profile</button>
            </form>
          </div>
        </section>
      <% } %>

      <!-- Account and profile overview: support search, browsing, and updates -->
      <section class="section" aria-labelledby="account-list-title">
        <div class="section__header">
          <h2 id="account-list-title">User Accounts Overview</h2>
          <form class="inline-form" method="get" action="/dashboard">
            <label for="account-search">Keyword search</label>
            <input
              id="account-search"
              type="search"
              name="accountSearch"
              value="<%= accountKeyword %>"
              placeholder="Search by username, display name, or role"
            />
            <% if (profileKeyword) { %>
              <input type="hidden" name="profileSearch" value="<%= profileKeyword %>" />
            <% } %>
            <button type="submit">Search</button>
          </form>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Username</th>
                <th>Display Name</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <% if (currentUser.role === 'User Administrator') { %>
                  <th>Actions</th>
                <% } %>
              </tr>
            </thead>
            <tbody>
              <% accounts.forEach((account) => { %>
                <tr>
                  <td><%= account.username %></td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/accounts/update">
                        <input type="hidden" name="username" value="<%= account.username %>" />
                        <input type="text" name="displayName" value="<%= account.displayName %>" required />
                        <input type="hidden" name="role" value="<%= account.role %>" />
                        <input type="hidden" name="status" value="<%= account.status %>" />
                        <button type="submit">Save Name</button>
                      </form>
                    <% } else { %>
                      <%= account.displayName %>
                    <% } %>
                  </td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/accounts/update">
                        <input type="hidden" name="username" value="<%= account.username %>" />
                        <input type="hidden" name="displayName" value="<%= account.displayName %>" />
                        <select name="role">
                          <% roles.forEach((role) => { %>
                            <option value="<%= role.name %>" <%= account.role === role.name ? 'selected' : '' %>><%= role.name %></option>
                          <% }) %>
                        </select>
                        <input type="hidden" name="status" value="<%= account.status %>" />
                        <button type="submit">Save Role</button>
                      </form>
                    <% } else { %>
                      <%= account.role %>
                    <% } %>
                  </td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/accounts/update">
                        <input type="hidden" name="username" value="<%= account.username %>" />
                        <input type="hidden" name="displayName" value="<%= account.displayName %>" />
                        <input type="hidden" name="role" value="<%= account.role %>" />
                        <select name="status">
                          <option value="active" <%= account.status === 'active' ? 'selected' : '' %>>Active</option>
                          <option value="suspended" <%= account.status === 'suspended' ? 'selected' : '' %>>Suspended</option>
                        </select>
                        <button type="submit">Save Status</button>
                      </form>
                    <% } else { %>
                      <%= account.status === 'active' ? 'Active' : 'Suspended' %>
                    <% } %>
                  </td>
                  <td><%= account.lastLogin %></td>
                  <% if (currentUser.role === 'User Administrator') { %>
                    <td>
                      <form class="table-form" method="post" action="/admin/accounts/suspend">
                        <input type="hidden" name="username" value="<%= account.username %>" />
                        <button type="submit">Suspend Account</button>
                      </form>
                    </td>
                  <% } %>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section" aria-labelledby="profile-list-title">
        <div class="section__header">
          <h2 id="profile-list-title">User Profiles Overview</h2>
          <form class="inline-form" method="get" action="/dashboard">
            <label for="profile-search">Keyword search</label>
            <input
              id="profile-search"
              type="search"
              name="profileSearch"
              value="<%= profileKeyword %>"
              placeholder="Search by profile name or description"
            />
            <% if (accountKeyword) { %>
              <input type="hidden" name="accountSearch" value="<%= accountKeyword %>" />
            <% } %>
            <button type="submit">Search</button>
          </form>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Profile Name</th>
                <th>Description</th>
                <th>Permissions</th>
                <th>Status</th>
                <% if (currentUser.role === 'User Administrator') { %>
                  <th>Actions</th>
                <% } %>
              </tr>
            </thead>
            <tbody>
              <% profiles.forEach((profile) => { %>
                <tr>
                  <td><%= profile.name %></td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/profiles/update">
                        <input type="hidden" name="name" value="<%= profile.name %>" />
                        <textarea name="description" rows="2" required><%= profile.description %></textarea>
                        <input type="hidden" name="status" value="<%= profile.status %>" />
                        <input type="hidden" name="permissions" value="<%= profile.permissions.join(', ') %>" />
                        <button type="submit">Save Description</button>
                      </form>
                    <% } else { %>
                      <%= profile.description %>
                    <% } %>
                  </td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/profiles/update">
                        <input type="hidden" name="name" value="<%= profile.name %>" />
                        <input type="hidden" name="description" value="<%= profile.description %>" />
                        <input type="hidden" name="status" value="<%= profile.status %>" />
                        <textarea name="permissions" rows="2" placeholder="Enter permissions separated by commas"><%= profile.permissions.join(', ') %></textarea>
                        <button type="submit">Save Permissions</button>
                      </form>
                    <% } else { %>
                      <ul>
                        <% profile.permissions.forEach((item) => { %>
                          <li><%= item %></li>
                        <% }) %>
                      </ul>
                    <% } %>
                  </td>
                  <td>
                    <% if (currentUser.role === 'User Administrator') { %>
                      <form class="table-form" method="post" action="/admin/profiles/update">
                        <input type="hidden" name="name" value="<%= profile.name %>" />
                        <input type="hidden" name="description" value="<%= profile.description %>" />
                        <input type="hidden" name="permissions" value="<%= profile.permissions.join(', ') %>" />
                        <select name="status">
                          <option value="active" <%= profile.status === 'active' ? 'selected' : '' %>>Active</option>
                          <option value="suspended" <%= profile.status === 'suspended' ? 'selected' : '' %>>Suspended</option>
                        </select>
                        <button type="submit">Save Status</button>
                      </form>
                    <% } else { %>
                      <%= profile.status === 'active' ? 'Active' : 'Suspended' %>
                    <% } %>
                  </td>
                  <% if (currentUser.role === 'User Administrator') { %>
                    <td>
                      <form class="table-form" method="post" action="/admin/profiles/suspend">
                        <input type="hidden" name="name" value="<%= profile.name %>" />
                        <button type="submit">Suspend Profile</button>
                      </form>
                    </td>
                  <% } %>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </section>

      <!-- CSR representative perspective: highlight volunteer activity -->
      <section class="section" aria-labelledby="csr-title">
        <h2 id="csr-title">CSR Volunteer Activity</h2>
        <div class="grid">
          <article class="card">
            <h3>Open Volunteer Opportunities</h3>
            <ul>
              <% volunteerOpportunities.forEach((item) => { %>
                <li>
                  <strong><%= item.title %></strong> | <%= item.category %> | <%= item.location %> | <%= item.schedule %>
                </li>
              <% }) %>
            </ul>
          </article>
          <article class="card">
            <h3>Shortlisted Opportunities (Sample)</h3>
            <ul>
              <% csrShortlist.forEach((item) => { %>
                <li><strong><%= item.title %></strong> | <%= item.desc %></li>
              <% }) %>
            </ul>
          </article>
          <article class="card">
            <h3>Completed Service History</h3>
            <ul>
              <% csrHistory.forEach((item) => { %>
                <li>
                  <strong><%= item.title %></strong> | <%= item.category %> | <%= item.serviceDate %> | <%= item.duration %>
                </li>
              <% }) %>
            </ul>
          </article>
        </div>
      </section>

      <!-- PIN perspective: show requests and engagement metrics -->
      <section class="section" aria-labelledby="pin-title">
        <h2 id="pin-title">PIN Engagement Insights</h2>
        <div class="grid">
          <article class="card">
            <h3>Active Help Requests</h3>
            <ul>
              <% pinRequests.forEach((item) => { %>
                <li>
                  <strong><%= item.title %></strong> | <%= item.category %> | Status: <%= requestStatuses[item.status].label %> | Views: <%= item.views %> | Shortlisted: <%= item.favorites %>
                </li>
              <% }) %>
            </ul>
          </article>
          <article class="card">
            <h3>Visibility Metrics</h3>
            <ul>
              <% pinMetrics.forEach((metric) => { %>
                <li><strong><%= metric.title %></strong> | Value: <%= metric.value %> | Note: <%= metric.description %></li>
              <% }) %>
            </ul>
          </article>
          <article class="card">
            <h3>Completed Matches</h3>
            <ul>
              <% pinMatches.forEach((match) => { %>
                <li>
                  <strong><%= match.service %></strong> | CSR: <%= match.csr %> | Completed: <%= match.completedAt %> | Feedback: <%= match.feedback %>
                </li>
              <% }) %>
            </ul>
          </article>
        </div>
      </section>

      <!-- Platform management perspective: manage categories and reports -->
      <section class="section" aria-labelledby="platform-title">
        <h2 id="platform-title">Platform Operations</h2>
        <div class="grid">
          <article class="card">
            <h3>Service Categories</h3>
            <ul>
              <% serviceCategories.forEach((category) => { %>
                <li><strong><%= category.name %></strong> | Status: <%= requestStatuses[category.status] ? requestStatuses[category.status].label : category.status %></li>
              <% }) %>
            </ul>
          </article>
          <article class="card">
            <h3>Report Highlights</h3>
            <ul>
              <% reports.forEach((report) => { %>
                <li>
                  <strong><%= report.title %></strong>
                  <ul>
                    <% report.highlights.forEach((highlight) => { %>
                      <li><%= highlight %></li>
                    <% }) %>
                  </ul>
                </li>
              <% }) %>
            </ul>
          </article>
        </div>
      </section>
    </main>

    <!-- Footer: display copyright information -->
    <footer class="footer">
      <p>© 2025 CSR Volunteer Matching Platform</p>
    </footer>
  </body>
</html>
